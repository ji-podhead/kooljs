(()=>{"use strict";var __webpack_require__={d:(e,r)=>{for(var t in r)__webpack_require__.o(r,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)},__webpack_exports__={},finished=[],fps=10.33,signal,controller=null,triggers_step;async function sleep(e){return new Promise((r=>setTimeout(r,e)))}class Lerp{constructor(){this.type=void 0,this.delta_t=void 0,this.duration=void 0,this.render_interval=void 0,this.delay_delta=void 0,this.delay=void 0,this.progress=void 0,this.smoothstep=void 0,this.lerp_chain_start=void 0,this.loop=void 0,this.activelist=[],this.results=new Map}reset(e){0==this.activelist.includes(e)&&this.activelist.push(e)}get(e){return this.results.get(e)}}var trigger_registry=new Map;class LerpChain{constructor(){this.buffer=void 0,this.matrixChains=void 0,this.progress=void 0,this.lengths=void 0}update_progress(e){return this.progress[e]==this.lengths[e]-1||(this.progress[e]+=1,lerp_registry.progress[e]=0,!1)}reset(e){lerp_registry.reset(e),lerp_registry.progress[e]=0,this.progress[e]=0}soft_reset(e){lerp_registry.progress[e]==lerp_registry.duration[e]&&(lerp_registry.reset(e),lerp_registry.progress[e]=0),lerpChain_registry.progress[e]==lerpChain_registry.lengths[e]-1?lerpChain_registry.reset(e):0==lerp_registry.activelist.includes(e)&&lerp_registry.activelist.push(e)}}class Callback{constructor(){this.callback=new Map,this.condition=new Map}}class Constant{constructor(e,r){this.matrix=void 0,this.number=void 0}update(e,r,t){constant_registry[e][r]=t}get(e,r){return constant_registry[e][r]}}const lerp_registry=new Lerp,constant_registry=new Constant,callback_registry=new Callback,lerpChain_registry=new LerpChain;var t,targets;function smoothLerp(e,r,s,i){return r*(t=smoothstep(s))+e*(1-t)}function smoothstep(e){return e*e*(3-2*e)}async function animate(){return finished=[],lerp_registry.activelist.map(((e,r)=>{if(lerp_registry.progress[e]<lerp_registry.duration[e])if(lerp_registry.delay_delta[e]<lerp_registry.delay[e])lerp_registry.delay_delta[e]+=1;else{switch(lerp_registry.progress[e]+=1,lerp_registry.delta_t[e]=lerp_registry.progress[e]/lerp_registry.duration[e],lerp_registry.type[e]){case 2:lerp_registry.results.set(e,smoothLerp(lerpChain_registry.buffer[lerp_registry.lerp_chain_start[e]+lerpChain_registry.progress[e]],lerpChain_registry.buffer[lerp_registry.lerp_chain_start[e]+lerpChain_registry.progress[e]+1],lerp_registry.delta_t[e],lerp_registry.smoothstep[e]));break;case 3:for(let r=0;r<lerpChain_registry.matrixChains.get(e).get(lerpChain_registry.progress[e]).length;r++)lerp_registry.results.get(e)[r]=smoothLerp(lerpChain_registry.matrixChains.get(e).get(lerpChain_registry.progress[e])[r],lerpChain_registry.matrixChains.get(e).get(lerpChain_registry.progress[e]+1)[r],lerp_registry.delta_t[e],lerp_registry.smoothstep[e]);break;default:return console.error("wrong type"+String(e))}const r={id:e,value:lerp_registry.results.get(e),time:lerp_registry.progress[e],step:lerpChain_registry.progress[e]};void 0!=callback_registry.condition.get(e)&&1==callback_registry.condition.get(e)(r)&&callback_registry.callback.get(e)(r),void 0!=(triggers_step=void 0!=trigger_registry.get(e)?trigger_registry.get(e).get(lerpChain_registry.progress[e]):void 0)&&(targets=triggers_step.get(lerp_registry.progress[e]))&&targets.map((e=>{lerpChain_registry.soft_reset(e)}))}else void 0!=lerp_registry.lerp_chain_start[e]&&1==lerpChain_registry.update_progress(e)&&finished.push(e)})),finished}async function animateLoop(){var e;for(controller=new AbortController,signal=controller.signal;!signal.aborted&&null!=controller;){e=performance.now(),finished=[],lerp_registry.activelist.length>0&&await animate().then((e=>{render(),e.length>0&&fin(e)}));const r=performance.now()-e,t=Math.max(0,fps-r);await sleep(t)}}function fin(e){lerp_registry.activelist=lerp_registry.activelist.filter((r=>!e.includes(r))),0==lerp_registry.activelist.length&&stop_loop()}function start_loop(){null==controller&&animateLoop()}function stop_loop(){null!==controller&&(controller.abort(),controller=null)}function start_animations(e){e.map((e=>{lerpChain_registry.soft_reset(e),start_loop()}))}function stop_animations(e){"all"==e&&(e=lerp_registry.activelist),e.map((e=>{lerp_registry.activelist.includes(e)&&(lerp_registry.activelist=lerp_registry.activelist.filter((r=>r!=e))),0==lerp_registry.activelist.length&&stop_loop()}))}async function reset_animations(e){"all"==e&&(stop_loop(),e=lerp_registry.activelist);const r=[];e.map((e=>{if(lerpChain_registry.reset(e),lerp_registry.reset(e),0==lerp_registry.activelist.includes(e)||null==controller)switch(r.push(e),lerp_registry.type[e]){case 2:lerp_registry.results.set(e,lerpChain_registry.buffer[lerp_registry.lerp_chain_start[e]]);break;case 3:lerp_registry.results.set(e,lerpChain_registry.matrixChains.get(e).get(0))}})),r.length>0&&postMessage({message:"render",results:lerp_registry.results,result_indices:e})}function change_framerate(e){fps=e}function init(lerps,lerpChains,matrixChains,triggers,constants,condi_new,springs){trigger_registry=triggers,condi_new.forEach(((val,key)=>{callback_registry.callback.set(key,eval(val.callback)),callback_registry.condition.set(key,eval(val.condition))})),lerpChains.forEach(((e,r)=>{lerpChain_registry[r]=new Float32Array(e)})),lerpChain_registry.matrixChains=matrixChains,lerps.forEach(((e,r)=>{0==["loop"].includes(r)?lerp_registry[r]=new Float32Array(e):lerp_registry[r]=new Uint8Array(e)})),void 0!=constants.get("matrix")&&constants.get("matrix").forEach((e=>{constant_registry.matrix.push(new Float32Array(e))})),void 0!=constants.get("number")&&(constant_registry.number=new Float32Array(constants.get("number"))),lerp_registry.type.map(((e,r)=>{2==e?lerp_registry.results.set(r,-1):lerp_registry.results.set(r,new Float32Array(lerpChain_registry.matrixChains.get(r).get(0)))})),lerp_registry.delta_t=new Float32Array(lerp_registry.duration.length)}function addTrigger(e,r,t,s){var i=[];if(void 0==trigger_registry.get(e).get(t))trigger_registry.get(e).set(t,new Map),trigger_registry.get(e).get(t).set(s,new Uint8Array([r]));else if(void 0==trigger_registry.get(e).get(t).get(s))trigger_registry.get(e).get(t).set(s,new Uint8Array([r]));else if(i=trigger_registry.get(e).get(t).get(s),console.log(i),0==i.includes(r)){const a=new Uint8Array(new Array(i).push(r));console.log(a),trigger_registry.get(e).get(t).set(s,a)}}function removeTrigger(e,r,t,s){var i=trigger_registry.get(e).get(t);if(void 0==i)return console.error("the trigger registr has now element for the step");if(i=void 0!=i.get(s)?i.get(s):i,console.log(i),void 0!=i&&0==i.includes(r)&&trigger_registry.get(e).get(t).get(s).length>1){const a=new Uint8Array(new Array(i).splice(i.find(r),1));console.log(a),trigger_registry.get(e).get(t).set(s,a)}else trigger_registry.get(e).get(t).size>1?trigger_registry.get(e).get(t).set(s,void 0):trigger_registry.get(e).set(t,void 0)}function update(e,r){r.map((r=>{lerpChain_registry.lengths[r.id]!=r.values.length-1&&(console.log(trigger_registry.get(r.id)),1==lerp_registry.loop[r.id]&&(removeTrigger(r.id,r.id,lerpChain_registry.lengths[r.id]-1,lerp_registry.duration[r.id]),addTrigger(r.id,r.id,r.values.length-2,lerp_registry.duration[r.id])),lerpChain_registry.lengths[r.id]=r.values.length-1),2==e?r.values.map(((e,t)=>{lerpChain_registry.buffer[lerp_registry.lerp_chain_start[r.id]+t]=e})):3==e&&r.values.map(((e,t)=>{lerpChain_registry.matrixChains.get(r.id).set(t,e)})),lerpChain_registry.reset(r.id)}))}async function render(){postMessage({message:"render",results:lerp_registry.results,result_indices:lerp_registry.activelist})}function setLerp(e,r,t){lerpChain_registry.buffer[lerp_registry.lerp_chain_start[e]+r]=t}function setMatrix(e,r,t){t.map(((t,s)=>{lerpChain_registry.matrixChains.get(e).get(r)[s]=t}))}function get_time(e){return lerp_registry.delay_delta(e)}function current_step(e){return lerpChain_registry.progress(e)}function get_lerp_value(e){return lerp_registry.results.get(e)}function reset_lerp(e){lerp_registry.reset_lerp(e)}function set_duration(e,r){lerp_registry.duration[e]=r}function set_sequence_length(e,r){lerpChain_registry.lengths[e]=r}onmessage=e=>{switch(e.data.method){case"init":init(e.data.data,e.data.chain_map,e.data.matrix_chain_map,e.data.trigger_map,e.data.constants,e.data.callback_map,e.data.spring_map);break;case"update":update(e.data.type,e.data.data);break;case"update_constant":constant_registry.update(e.data.type,e.data.id,e.data.value);break;case"start":start_loop();break;case"stop":stop_loop();break;case"change_framerate":change_framerate(e.data.fps_new);break;case"start_animations":start_animations(e.data.indices);break;case"stop_animations":stop_animations(e.data.indices);break;case"reset_animations":reset_animations(e.data.indices);break;case"addTrigger":addTrigger(e.data.id,e.data.target,e.data.step,e.data.time);break;case"removeTrigger":removeTrigger(e.data.id,e.data.target,e.data.step,e.data.time)}};class Spring{constructor(e,r,t,s){this.elements=e,this.duration=r,this.spring_tension=t}}function shortest_path(){}function knn(){}function convex_hull(){}function spring(){}})();
//# sourceMappingURL=921.e2d8f3f1.chunk.js.map